<html xmlns="http://www.w3.org/1999/xhtml">
    <head>
        <title>雷霆项目组</title>
        <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
        <!-- easyui js引用加入!-->
        <script src="/webtool/site_media/lib/jquery-easyui-1.4.2/jquery.min.js" type="text/javascript" charset="utf-8"></script>
        
        <!-- D引用加入!-->
        <script src="/webtool/site_media/lib/other/js/djangoajax.js" type="text/javascript"></script> 
        <script src="/webtool/site_media/lib/jquery-easyui-1.4.2/jquery.easyui.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="/webtool/site_media/lib/jquery-easyui-1.4.2/locale/easyui-lang-zh_CN.js" type="text/javascript" charset="utf-8">
        </script>
        
        <!-- easyui datagridview引用加入!-->
        <script src="/webtool/site_media/lib/jquery-easyui-1.4.2/jquery-easyui-datagridview/datagrid-defaultview.js" type="text/javascript" 
        charset="utf-8"></script>
        <script src="/webtool/site_media/lib/jquery-easyui-1.4.2/jquery-easyui-datagridview/datagrid-groupview.js" type="text/javascript" charset="utf-8"></script> 
        <script src="/webtool/site_media/lib/jquery-easyui-1.4.2/jquery-easyui-datagridview/datagrid-detailview.js" type="text/javascript" charset="utf-8"></script> 
        <script src="/webtool/site_media/lib/jquery-easyui-1.4.2/datagrid-filter.js" type="text/javascript" charset="utf-8"></script>    
            
        <link rel="stylesheet" href="/webtool/site_media/lib/jquery-easyui-1.4.2/themes/default/easyui.css" type="text/css"></link>
        <link rel="stylesheet" href="/webtool/site_media/lib/jquery-easyui-1.4.2/themes/icon.css" type="text/css"></link>
            
        <!--button样式!-->
        <link rel="stylesheet" href="/webtool/site_media/lib/other/css/buttonstyle.css" type="text/css"></link>
        <script src="/webtool/site_media/lib/other/js/index_init.js" type="text/javascript"></script>

        <script type="text/javascript">
        	var editIndex = undefined; 
            $(function(){
				//$.post('/webtool/assign_zqjt/getDataFromMysql/',function(datas){
                $('#svn_maingrid').datagrid({
                    //singleSelect:true,
                    url:'/webtool/assign_zqjt/getDataFromMysql/',
                    fitColumns:true,
                    height:'auto',
                    rownumbers:true,

                    pagination:true,
                    pageSize:50,
                    pageList:[50,100,15,200],
                    collapsible:false,
					//data:datas,
                    fit:true,
                    columns:[[
                        { field: 'check', title:'checkbox', align: 'left', width: 10,checkbox:true},
                        { field: 'column0', title:'number', align: 'left', sortable:true,width: 5},
                        { field: 'column1', title:'column1', align: 'left', sortable:true,width: 40},
                        { field: 'column2', title:'column2', align: 'left', sortable:true,width: 40},
                        { field: 'column4', title:'column4', align: 'left', width: 40},
                        { field: 'column5', title:'column5', align: 'left', width: 10},
                        { field: 'column6', title:'column6', align: 'left', width: 10},
                        { field: 'QAer', title:'跟进QA', align: 'left', width: 10,
                                formatter:function(value,rowData,rowIndex){
                                    if(value == '请选择'){
                                        return "<font color='red'>"+ value +"<\/font>";
                                    }else{
                                        return value;
                                    }
                                },                           
                            editor:{
                                type:'combobox',
                                options:{
                                    valueField:'id',
                                    textField:'QAer',
                                    data:[{id:'请选择',QAer:'请选择'},{id:'黄超群',QAer:'黄超群'},{id:'汪斌',QAer:'汪斌'},
                                    {id:'朱军',QAer:'朱军'},{id:'徐勇军',QAer:'徐勇军'}],
                                    required:true
                                }
                            }               
                        },
                        { field: 'isFinished', title:'状态', align: 'left', width: 10,
                            editor:{
                                type:'combobox',
                                options:{
                                    valueField:'id',
                                    textField:'isFinished',
                                    data:[{id:'完成',isFinished:'完成'},{id:'未完成',isFinished:'未完成'}],
                                    required:true
                                }
                            }  
                        },
                        {field:'action',title:'Action',width:10,align:'center',
                        	formatter:function(value,row,index){
                        		var s = "<a href='#' onclick=saverow("+index+")>Save</a>";
                        		return s;
                        	} 
                        }
                    ]],
                    // onClickRow:function(rowIndex,row){
                    // 		editIndex = rowIndex;
                    //         $(this).datagrid('uncheckAll');
                    //         $(this).datagrid('checkRow',rowIndex);
                    //     },
                    onDblClickRow: function(rowIndex, rowData){
                        if(endEditing())
                        {
                        	$(this).datagrid('checkRow',rowIndex);
                            $(this).datagrid('beginEdit', rowIndex); 
                            editIndex = rowIndex;
                        }
                    },
                    rowStyler:function(rowIndex,rowData){
                            if(rowData.isFinished=='未完成') return 'background-color:#FFFDDD;'
                            if(rowData.isFinished=='完成') return 'background-color:#FFFFFF;'
                        },
				});
            //});
        });
        function saverow(index){
        	$('#svn_maingrid').datagrid('endEdit',index);
        	var rows = $('#svn_maingrid').datagrid('getData').rows;
        	$.post("/webtool/assign_zqjt/updateDataToMysql/",{number:rows[index]['column0'],QAer:rows[index]['QAer'],isFinished:rows[index]['isFinished']});
        };

        function endEditing(){
            if ($('#svn_maingrid').datagrid('validateRow', editIndex)){
                var rows = $('#svn_maingrid').datagrid('getRows');
                for ( var i = 0; i < rows.length; i++) {
                   $('#svn_maingrid').datagrid('endEdit', i);
                }
                return true;
            } else {
                return false;
            }
        };

        function save_to_db(){
        	$('#svn_maingrid').datagrid('endEdit',editIndex);
			var rows = $('#svn_maingrid').datagrid('getData').rows;
			for ( var i = 0; i < rows.length; i++)
			{
				$.post("/webtool/assign_zqjt/updateDataToMysql/",{number:rows[i]['column0'],QAer:rows[i]['QAer'],isFinished:rows[i]['isFinished']});
			}
			
        };
        function search_data(){
        	$('#svn_maingrid').datagrid(
        		'reload',
        		{
        			QA:$('#QA_to_select').combobox('getValue'),
        			state:$('#state_to_select').combobox('getValue')
        		}
        	)
        };

        function assign(){
        	var rows = $('#svn_maingrid').datagrid('getChecked');	
        	var qa_name=$('#allocate_qaer').combobox('getValue');

            if(rows.length){
                for (var i = 0; i < rows.length; i++) 
                {
                    var rowindex = $('#svn_maingrid').datagrid('getRowIndex', rows[i]);
                    $('#svn_maingrid').datagrid('beginEdit', rowindex);
                    $('#svn_maingrid').datagrid('updateRow',{index:rowindex,row:{QAer:qa_name}});
                    $('#svn_maingrid').datagrid('endEdit', rowindex);
                }
            }
        };

        </script>
    </head>
    <div class='easyui-layout' style="width:1600px; height:1000px;">
        <div id="svn_div_datagrid" title="最强军团****" class="easyui-panel" data-options="region:'center',border:false" style="padding:10px">
            <table id="svn_maingrid" class="easyui-datagrid" toolbar='#tb'></table>
        </div>
        <div id="tb" style="text-align:left;">
            <span>跟进QA</span>
            <select id="QA_to_select" class="easyui-combobox" style="width:80px;">
                <option>所有</option>
                <option>黄超群</option>
                <option>汪斌</option>
                <option>朱军</option>
                <option>徐勇军</option>
            </select>
            <span>状态</span>
            <select id="state_to_select" class="easyui-combobox" style="width:80px;">
                <option>所有</option>
                <option>完成</option>
                <option>未完成</option>
            </select>
            <a href='#' class='easyui-linkbutton' plain='true' iconCls='icon-search' onclick="search_data()">查询</a>     	
            <a href="#" class="easyui-linkbutton" iconCls="icon-save" plain="true" onclick="save_to_db()">保存所有</a>

            <a href="#" class="easyui-linkbutton" iconCls="icon-print" plain="true" onclick="assign()" style="float:right">一键分配</a>            
            <a style="float:right">
            <span>跟进QA</span>
            <select id= "allocate_qaer" class="easyui-combobox" style="width:80px; float:right">
            	<option>请选择</option>
                <option>黄超群</option>
                <option>汪斌</option>
                <option>朱军</option>
                <option>徐勇军</option>
            </select>
            </a>                     
        </div>
    </div>
</html>
